资料补充：[DEA (数据包络分析)介绍及 python3 实现 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/60853027)
通俗理解：[浅聊DEA--数据包络分析 - 一千年以后的文章 - 知乎](https://zhuanlan.zhihu.com/p/133694193)

数据包络分析，一种效率评价的非参数方法
绩效评估是评估组织或个人如何以*较少的资源获得较多的产出*结果的多属性评估，也称之为成本效益分析。数据包络分析是 A.Charnes, W.W.Copper 和 E.Rhodes 在 1978 年提出的评价多指标输入输出，衡量系统有效性的方法。将属性划分为投入项、产出项（成本型、效益型指标），不预先设定权重，只关心总产出与总投入，以其比率作为相对效率。数据包络分析有多种模式，主要为：CCR 模式，BBC 模式、交叉模式、A&P 模式。

### 问题引入
#### 效率评价
![[微信截图_20230713114205.png]]

配置效率AE：由价格与技术给定，代表*生产给定投入的最优组合*（基本确定）
规模效率SE：生产经营规模和经济效益的关系，代表*生产规模的有效程度*
技术效率TE：给定投入要素不变，实际值/理论上的理想值，代表*现有技术的有效利用程度*

![[微信截图_20230713114828.png]]
Q：如何对这三个企业的生产效率进行评价？

## 数据包络分析简介

**基本概念：**
1. *决策单元（DMU）*：指具有相同类型的部门、企业或同一企业的不同时期等；在一定范围内通过一定数量生产要素产出一定数量的产出
2. *投入指标*：指DMU在经济活动中需要耗费的经济量，如固定资产、流动资金、职工人数、占用土地等
3. *产出指标*：指DMU的经济活动产生的成效，如销售收入、利税、产品数量、利润等
4. *指标数据*：指投入、产出指标的实际观测结果

**简介：**
通过对生产决策单元（DMU）输入与输出数据的研究，评价具有**相同**类型的**多指标投入、多指标产出**决策单元**相对有效性**的多目标决策方法

基本类型：
	1. 以**投入**为导向的CCR：假设**产出效率不变**，得到投入最小化(STE)
	    分析*综合效率STE*（规模效率SE+纯技术效率PTE）（不考虑规模收益）
	       ------------------------------------
	2. 以**产出**为导向的BCC：假设**投入要素不变**，得到产出最大化（TE、SE、PTE)（考虑规模收益）
	    分析*纯技术效率PTE*

对于金融机构，我们可以综合利用CCR和BCC，分析综合效率、纯技术效率和规模效率，有以下关系：$STE_{CCR} = PTE_{BCC} \times SE$

STE和PTE分别可以用两个基本类型求解，SE可以由前两者计算得出

**DEA有效性：**
	1. *技术有效*：*输出相对输入而言已达最大*，即该决策单元*位于生产函数的曲线上*
	2. *规模有效*：指投入量*既不偏大，也不过小*，是介于规模收入收益由递增到递减之间的状态，即处于规模效益不变的状态
	3. 生产函数 $y=f(x)$ : 表示在生产处于*最好的理想状态*时，当投入量为X，所能获得的最大输出。因此，生产函数图像上的点对应的决策单元，从生产函数的角度看，是属于“技术有效”的状态。一般来说生产函数图像如下，A、C处于技术有效状态。
	 ![[微信截图_20230713121951.png]]
	如果没有给出生产函数，则*斜率越大，那么投入-产出比越大*。本图中A点斜率最大，则A处于技术有效状态

## 基本步骤
### 1. CCR（$C^2R$ )模型的建立
设：
	$n$ 个决策单元( $j = 1, 2, ..., n$)，每个决策单元有相同的 $m$ 项投入(输入)($i =1, 2, ..., m$)，$s$ 项产出(输出)($r = 1,2,...,s$)，第 $i$ 项投入的权系数为 $v_i$ ，第 $r$ 项产出的权系数为 $u_r$ 
	那么第 $j$ 个决策单元的输出综合为 $\sum_{r=1}^s u_r y_{rj}$，输入综合为 $\sum_{i=1}^m v_i x_{ij}$
	**效率评价指数**: $$Z_j = \frac{\sum_{r=1}^s u_r y_{rj}}{\sum_{i=1}^m v_i x_{ij}}$$
	![[微信截图_20230713133820.png]]
	![[微信截图_20230713133900.png]]
每一个决策单元都需要建立一个模型进行单独评价。以第 $j_0(1 \leq j_0 \leq n)$ 个决策单元的效率评价指数最大化为目标函数，所有决策单元的**效率评价指数不超过 $1$ 为约束条件**（效率不超过$100$%)，可以构造第 $j_0(1 \leq j_0 \leq n)$ 个决策单元的CCR模型，这是一个**分式规划**模型：
$$max Z_{j_0} = \frac{\sum_{r=1}^s u_r y_{rj_0}}{\sum_{i=1}^m v_i x_{ij_0}}$$
$$\begin{cases} \frac{\sum_{r=1}^s u_r y_{rj}}{\sum_{i=1}^m v_i x_{ij}} \leq 1, & j=1,2,...n \\ \sum_{i=1}^m v_i = \sum_{r=1}^s u_r =1 \\ v_i, u_r \ge 0, &i=1, ...m;\ r=1,...,s\end{cases}$$
**问题**：未知权重，要寻找权重，使得有这样的权重使得效率达到最大值（线性规划）

分式规划模型要进行转化，使之成为线性规划模型，进而可以**利用线性规划问题解决**的计算方法，利用 `matlab` 或 `lingo` 求解最终的目标函数（即STE)

令$t=\frac{1}{\sum_{i=1}^m v_i x_{ij}}, \mu_r = tu_r, \omega_i = tv_i$，原模型转换为

目标函数:
 $$max \  h_{j_0}=\sum_{r=1}^s \mu_r y_{r j_0}$$
约束条件
$$\begin{cases} \sum_{r=1}^s u_r y_{rj}-\sum_{i=1}^m v_i x_{ij} \leq 0, & j=1,2,...n \\ \sum_{i=1}^m \omega_ix_{ij_0} =1 \\ \mu_r, \omega_i \ge 0 , &i=1, ...m;\ r=1,...,s\end{cases}$$

所求为一个最小值，将其**转化成对偶问题**，那么也就得到了要求的STE指标：

目标函数：$min \ STE_{j_0}$
约束条件：
$$\begin{cases} \sum_{j=1}^n \lambda_j x_{ij} \leq STE_{j_0} x_{ij_0}, & i=1,...m \\ \sum_{j=1}^n \lambda_j y_{rj} \leq y_{rj_0} &r=1,...,s \\ \lambda_j \ge0, &j=1,...,n \end{cases}$$

注：对偶问题构造方法：
**原问题：**
$$ max\ Z=c_1 x_1+c_2x_2+ c_3x_3$$
$$s.t.\begin{cases} a_{11}x_1+a_{12}x_2+a_{13}x_3 \leq b_1\\ a_{21}x_1+a_{22}x_2+a_{23}x_3 = b_2\\ a_{31}x_1+a_{32}x_2+a_{33}x_3 \ge b_3 \\ x_1 \ge 0, x_2 \leq 0, x_3无约束\end{cases}$$
转化为**对偶问题**：
$$ max\ W=b_1 y_1+b_2y_2+ b_3y_3$$
$$s.t.\begin{cases} a_{11}y_1+a_{12}y_2+a_{13}y_3 \leq c_1\\ a_{21}y_1+a_{22}y_2+a_{23}y_3 = c_2\\ a_{31}y_1+a_{32}y_2+a_{33}y_3 \ge c_3 \\ y_1 \ge 0, y_3 \leq 0, y_2无约束\end{cases}$$

### 2. 从CCR模型得到BCC模型
CCR模型：
$$min \ STE_{j_0}$$
$$s.t.\begin{cases} \sum_{j=1}^n \lambda_j x_{ij} \leq STE_{j_0} x_{ij_0}, & i=1,...m \\ \sum_{j=1}^n \lambda_j y_{rj} \leq y_{rj_0} &r=1,...,s \\ \lambda_j \ge0, &j=1,...,n \end{cases}$$
在规模报酬固定的情况下，决策单元满足$\sum_{j=1}^n \lambda_j =1$，消除规模效应的影响得到关于PTE的BCC模型如下，它也是一个线性规划模型
$$min \ PTE_{j_0}$$
$$s.t.\begin{cases} \sum_{j=1}^n \lambda_j x_{ij} \leq STE_{j_0} x_{ij_0}, & i=1,...m \\ \sum_{j=1}^n \lambda_j y_{rj} \leq y_{rj_0} &r=1,...,s \\ \sum_{j=1}^n \lambda_j=1 ,\quad \lambda_j \ge0, &j=1,...,n \end{cases}$$
### 求解模型
对于一个确定的评价对象，该项效率值指标等于1，就是有效的DEA，即说明那些评价对象的投入产出比达到最大，小于1的DEA是无效的，评价对象的各项指标需要改进。

具体求解可以**通过编程实现**。

如果要进行更复杂的判断，则需综合考虑松弛变量值判断DEA强有效还是弱有效

注：权重只是为了服务于指标，最终想到的还是最优解

## 小结
### 优点
1. 在处理多输出-多输入的有效性评价方面具有绝对优势;
2. 权重的确定以决策单元输入输出的实际数据求得，排除了很多主观因素，具有很强的客观性。
3. DEA方法假定每个输入、输出之间确实存在某种联系，但不必确定这种关系的显式表达式。
4. DEA方法所要求的样本量较少。

### 缺点:
1. DEA对异常值相当敏感;
2. DEA分析时，数据须具有同类可比性。

### 案例分析（附代码实现）：天津市的可持续发展程度
![[微信截图_20230713221542.png]]
```python
# 导入numpy库，用于处理多维数组和矩阵运算  
import numpy as np  
# 导入cvxpy库，用于求解凸优化问题  
import cvxpy as cp  
  
# 从data14_5.txt文件中读取数据，该文件包含10行5列的数据  
d = np.loadtxt('data14_5.txt')  
# 将数据分为两部分，前三列为a，后两列为b  
a = d[:, :3]; b = d[:, 3:]  
# 定义两个变量u和v，都是非负的，u是一个3维向量，v是一个2维向量  
u = cp.Variable(3, pos=True); v = cp.Variable(2, pos=True)  
# 对每一行数据进行循环处理  
for j in range(10):  
    # 定义约束条件，要求a乘以u大于等于b乘以v，且第j行的a乘以u等于1  
    con = [a @ u >= b @ v, a[j] @ u == 1]  
    # 定义目标函数，要求最大化第j行的b乘以v  
    obj = cp.Maximize(b[j]@v)  
    # 定义优化问题，包含目标函数和约束条件  
    prob = cp.Problem(obj, con)  
    # 使用GLPK_MI求解器求解优化问题，并得到最优值和最优解  
    prob.solve(solver='GLPK_MI')  
    # 打印第j个对象的最优值，保留四位小数  
    print('第', str(j+1), '个对象最优值：', round(prob.value, 4))  
    # 打印最优解，保留四位小数  
    print('最优解：\n', np.round(u.value, 4), '\n', np.round(v.value, 4))
```
注：取自教材《数学建模算法与应用》
