推荐阅读：
姜启源《数学模型(第五版)》
《Convex Optimation》
## 概述
在人们的生产实践中，经常会遇到如何利用现有资源来安排生产，以取得最大经济效益的问题。此类问题构成了运筹学的一个重要分支—数学规划，而线性规划(Linear Programming 简记 LP)则是数学规划的一个重要分支。自从 1947 年 G. B. Dantzig 提出求解线性规划的单纯形方法以来，线性规划在理论上趋向成熟，在实用中日益广泛与深入。特别是在计算机能处理成千上万个约束条件和决策变量的线性规划问题之后，线性规划的适用领域更为广泛了，已成为现代管理中经常采用的基本方法之一。

数学规划是运筹学的一个分支，其用来研究在给定的条件下（约束条件），如何按照某一衡量指标（目标函数）来寻求计划、管理工作中的最优方案。用数学语言说明，即为求目标函数在一定的约束条件下的极值问题。

### 一般形式
$$ \max (或\min) z = f(x) / \sum_{j=1}^nc_jx_j$$
$$st.(subject \quad to，受约束于) \begin{cases} \sum_{j=1}^n a_{ij}x_j \leq(/\ge/=) b_i \\ x_j \ge 0, j= 1,2,...,n \end{cases}$$
也可写成$st. g_i(x) \leq 0, i=1,2,...,n$，也可能有等式约束，整数约束，或两者皆有。

我们把 $x$ 称为决策变量（一般有多个），$f(x)$称为目标函数，含有约束的等式、不等式等称为约束条件。

### 分类
**线性规划：**
	如果目标函数$f(x)$和约束条件均是决策变量的线性表达式，那么此时的数学规划问题就属于线性规划
**非线性规划：**
	当目标函数$f(x)$或者约束条件中有一个是决策变量$x$的非线性表达式，那么此时的数学规划问题就属于非线性规划，目前没有通用算法
**整数规划：**
	一类要求变量取整数值的数学规划，分为线性与非线性整数规划。目前大部分算法往往只适用于线性整数规划，非线性整数规划可采用蒙特卡洛模拟来求解
**01规划：** 
	整数规划的特例，整数变量的取值只能为0和1

## Matlab 线性规划的标准型(Python 有点不同)
$$\min C^T \vec x(向量的内积)， C=[c_1, c_2,\dots,c_n], \vec x = [x_1, \dots, x_n]^T $$
$$\begin{cases}
A \vec x &= \vec b, &(不等式约束)\\
Aeq \vec x &= beq, &(等式约束)\\
lb \quad \leq x &\leq ub  &(上下界约束).
\end{cases}
$$
注意：可能只对部分决策变量有约束

### 例题1
![721f557a72de2196daec7127530a9f5.jpg|700](https://cdn.jsdelivr.net/gh/BlackJack0083/image@main/img/721f557a72de2196daec7127530a9f5.jpg)
```python
import cvxpy as cp
from numpy import array

c = array([70, 50, 60])  #定义目标向量
a = array([[2, 4, 3], [3, 1, 5], [7, 3, 5]])  #定义约束矩阵
b = array([150, 160, 200])  #定义约束条件的右边向量
x = cp.Variable(3, pos=True)  #定义3个决策变量

obj = cp.Maximize(c@x)    #构造目标函数
cons = [a@x <=b]     #构造约束条件
prob = cp.Problem(obj, cons)
prob.solve(solver='GLPK_MI')   #求解问题
print('最优解为：', x.value)
print('最优值为：', prob.value)
```

### 例题2
![ba51f2e63b68fb6ff6c51a1a8352fc2.jpg](https://cdn.jsdelivr.net/gh/BlackJack0083/image@main/img/ba51f2e63b68fb6ff6c51a1a8352fc2.jpg)
```python
#程序文件ex4_3.py
import cvxpy as cp
# pos=True说明所有元素非负
x=cp.Variable((5,4),pos=True)
obj=cp.Maximize(1.15*x[3,0]+1.40*x[1,2]+1.25*x[2,1]+1.06*x[4,3])
cons=[x[0,0]+x[0,3]==100000,
      x[1,0]+x[1,2]+x[1,3]==1.06*x[0,3],
      x[2,0]+x[2,1]+x[2,3]==1.15*x[0,0]+1.06*x[1,3],
      x[3,0]+x[3,3]==1.15*x[1,0]+1.06*x[2,3],
      x[4,3]==1.15*x[2,0]+1.06*x[3,3],
      x[2,1]<=40000,x[1,2]<=30000]
prob=cp.Problem(obj,cons)
# GNU线性规划工具包（GLPK）的混合整数求解器
prob.solve(solver='GLPK_MI')
print("最优值为：",prob.value)
print("最优解为：",x.value)
```
## 整数规划问题
### 01 背包问题(非DP解法)
一个旅行者外出旅行，携带一背包，有$n$种物品供选择，已知每件物品的使用价值$c_i$和质量$a_i$，每件物品要么不带，要么只能整件携带，背包的最大容量为$b_i$，请问如何使得总使用价值最大？
**决策变量**：
$$x_i = \begin{cases}1, 携带第\ i \ 种物品\\
0,不携带第\ i \ 种物品\end{cases}$$
**目标函数**：使用价值最大，即
$$\max z = \sum_{i=1}^n c_i x_i$$
**约束条件**：
1. 质量限制：$\sum_{i=1}^na_ix_i \leq b$
2. 携带方式限制：$x_i=0或1, i=1,2,...,n.$

### 求解举例
![b619af59d4f9594ae07d562ed82dc69.jpg](https://cdn.jsdelivr.net/gh/BlackJack0083/image@main/img/b619af59d4f9594ae07d562ed82dc69.jpg)
**模型假设：** 
1. 每名工人每24h只能工作8h
2. 每名工人只能在某个班次的初始时刻报到
**符号说明：**
设$x_i$表示在第$i$个班次报到的工人数量，$i=1,2,...,6$
**模型建立**
$$\min z = \sum_{i=1}^6x_i$$
$$s.t.\begin{cases}
x_1 + x_6 \ge 35,\\
x_1 + x_2 \ge 40,\\
x_2 + x_3 \ge 50,\\
x_3 + x_4 \ge 45,\\
x_4 + x_5 \ge 55,\\
x_5 + x_6 \ge 30,\\
x_i \ge0 且为整数, i = 1,2,...,6
\end{cases}$$
```python
#程序文件ex4_9_1.py
import cvxpy as cp

x=cp.Variable(6, integer=True)
obj=cp.Minimize(sum(x))
cons=[x[0]+x[5]>=35, x[0]+x[1]>=40,
      x[1]+x[2]>=50, x[2]+x[3]>=45,
      x[3]+x[4]>=55, x[4]+x[5]>=30,
      x>=0]
prob=cp.Problem(obj,cons)
prob.solve(solver='GLPK_MI')
print("最优值为：",prob.value)
print("最优解为：",x.value)
```

### 实例(1998.A节选)
![b47444e5ed1d2d4ac3e378db59ccd7e.jpg](https://cdn.jsdelivr.net/gh/BlackJack0083/image@main/img/b47444e5ed1d2d4ac3e378db59ccd7e.jpg)
**模型建立：**
1. 总体风险用所投资$s_i$中最大的一个风险来衡量，即
	$$\max\{q_ix_i|i=1,2,...,n\}$$
2. 购买$s_i$所付交易费是一个分段函数，即
	$$交易费=\begin{cases}p_ix_i, x_i > u_i,\\p_iu_i, 0 < x_i \leq u_i,\\0, x_i = 0.\end{cases}$$
	而题目所给的定值$u_i$(单位：元)相比总投资$M$很少，$p_iu_i$更小，这样购买$s_i$的净收益可以简化为$(r_i-p_i)x_i$
3. 要想净收益尽可能大，总体风险尽可能小，这是一个多目标规划问题
	目标函数为
	$$\begin{cases}\max \sum_{i=0}^n(r_i-p_i)x_i,\\\min\{\max_{1\le i\le n}\{q_ix_i\}\}\end{cases}$$
	约束条件为
	$$\begin{cases}\sum_{i=1}^n(1+p_i)x_i=M,\\ x_i \ge 0, i=0,1...,n\end{cases}$$
两种解法：
1. 直接考虑多目标规划：序贯解法、线性加权等
2. 转化为单目标规划问题
#### 简化1
在实际投资时，投资者承受风险的程度不一样，若给定风险一个界限$a$，使最大的一个风险$\frac{q_ix_i}{M}\le a$，可找到相应的投资方案。这样把多目标规划变成一个目标的线性规划

原模型转化为：固定投资风险，优化收益
$$\max \sum_{i=0}^n(r_i-p_i)x_i$$
$$\begin{cases}\frac{q_ix_i}{M}\le a,i=1,2,...,n,\\\sum_{i=1}^n(1+p_i)x_i=M,\\ x_i \ge 0, i=0,1...,n\end{cases}$$

由于$a$为任意给定的风险度，没有一个准则，所以从$a=0$开始，以步长$\Delta a = 0.001$进行循环搜索：
```python
#程序文件ex4_12_1.py
import cvxpy as cp
import pylab as plt

b = plt.array([0.025, 0.015, 0.055, 0.026])  
c = plt.array([0.05, 0.27, 0.19, 0.185, 0.185])
x = cp.Variable(5, pos=True)
aeq = plt.array([1, 1.01, 1.02, 1.045, 1.065])
obj = cp.Maximize( c @ x)
a = 0; aa = []; Q = []; X = []; M = 10000;             
while a < 0.05:
    con = [aeq @ x == M, cp.multiply(b,x[1:])<=a*M]
    prob = cp.Problem(obj, con)
    prob.solve(solver='GLPK_MI')
    aa.append(a); Q.append(prob.value)
    X.append(x.value)
    a = a + 0.001
plt.rc('text', usetex=True); plt.rc('font', size=15)
plt.plot(aa, Q, 'r*'); plt.xlabel('$a$')
plt.ylabel('$Q$', rotation=0); plt.show()
```
#### 简化模型二：固定盈利水平，极小化风险
#### 简化模型三：两个目标函数加权求和(最常见)
$$\min w \{\max_{1\le i\le n}\{q_ix_i\}\}-(1-w)\sum_{i=0}^n(r_i-p_i)x_i$$
$$s.t.\begin{cases}\sum_{i=1}^n(1+p_i)x_i=M,\\ x_i \ge 0, i=0,1...,n\end{cases}$$
```python
#程序文件ex4_12_2.py
import numpy as np
import cvxpy as cp
import pylab as plt

plt.rc('font', family='SimHei')
plt.rc('font', size=15)
x = cp.Variable(6, pos = True)
r = np.array([0.05, 0.28, 0.21, 0.23, 0.25])
p = np.array([0, 0.01, 0.02, 0.045, 0.065])
q = np.array([0, 0.025, 0.015, 0.055, 0.026])

def LP(w):
    V = []  #风险初始化
    Q = []  #收益初始化
    X = []  #最优解的初始化
    con = [(1+p) @ x[: -1] == 10000, cp.multiply(q[1:],x[1:5])<=x[5]]
    for i in range(len(w)):
        obj = cp.Minimize(w[i] * x[5] - (1-w[i]) *((r-p) @ x[: -1]))
        prob = cp.Problem(obj, con)
        prob.solve(solver='GLPK_MI')
        xx = x.value   #提出所有决策变量的取值
        V.append(max(q*xx[:-1]))
        Q.append((r-p)@xx[:-1]); X.append(xx)
    print('w=', w);     print('V=', np.round(V,2))
    print('Q=', np.round(Q,2))
    plt.figure(); plt.plot(V, Q, '*-'); plt.grid('on')
    plt.xlabel('risk(yuan)'); plt.ylabel('earning(yuan)')
    return X

w1 = np.arange(0, 1.1, 0.1)
LP(w1); print('--------------')
w2 = np.array([0.766, 0.767, 0.810, 0.811, 0.824, 0.825, 0.962, 0.963, 1.0])
X=LP(w2); print(X[-3]); plt.show()
```

>[!note] 如果讲到这里还有很多时间，就问问要不要讲TSP问题

## 非线性规划
>[!note] 
>本来没有打算讲这么多数学的。。结果清风根本没讲清楚这部分，然后找的资料都是一堆公式堆在一起，那就顺便介绍一下。。
>这个地方可能代码部分不会太多，一方面是因为对于非凸规划没有什么好的数值计算方法，而国赛规划问题往往都是非凸的，一般都使用优化算法求解；另一方面，对于凸规划，常用的也是`cvxpy`，`scipy`，`sympy`，有条件愿意尝试的可以试试`gurobi`

![image.png](https://cdn.jsdelivr.net/gh/BlackJack0083/image@main/img/20240510211615.png)

### 基本理论
记 $\boldsymbol{x} = [x_1,x_2,...,x_n]^T$是 n 维欧几里得空间 $\boldsymbol{R^n}$ 中的一个点(n 维向量)。$f(\boldsymbol{x}), g_i(\boldsymbol{x})(i=1,2,...,p), h_j(\boldsymbol{x})(j=1,2...,q)$是定义在$\boldsymbol{R^n}$上的实值函数

若$f(x), g_i(x)和h_j(x)$中至少有一个是 $\boldsymbol{x}$ 的非线性函数，称如下的数学模型：
$$\min f(\boldsymbol x)$$
$$s.t.\begin{cases}g_i(\boldsymbol{x})\le 0, &i = 1,2,...,p,\\h_j(\boldsymbol{x})=0, &j=1,2,...,q.\end{cases}$$
为非线性规划模型的一般形式

称满足所有约束条件的点 $x$ 的集合
$$K=\{\boldsymbol{x}\in \boldsymbol{R^n}|g_i(\boldsymbol{x})\le 0, i = 1,...,p;h_j(\boldsymbol{x})=0,j=1,...,q\}$$
为非线性规划问题的约束集或可行域。对任意$\boldsymbol{x}\in K$，称$\boldsymbol{x}$为非线性规划问题的可行解或可行点

#### 局部极小与全局极小
记可行域为 $K$
1. **局部极小** 
对于$\boldsymbol{x^*}∈K$，如果存在某个 $ε>0$，使所有与$\boldsymbol{x^*}$的距离小于$ε$的$\boldsymbol{x}∈K$，都有$f(\boldsymbol{x^*}) \le f(\boldsymbol{x})$，则称$\boldsymbol{x^*}$为$f(x)$的局部极小点，$f(\boldsymbol{x^*})$为局部极小值。
对于$\boldsymbol{x^*}∈K$，如果存在某个 $ε>0$，使所有与$\boldsymbol{x^*}$的距离小于$ε$的$\boldsymbol{x}∈K, \boldsymbol{x} \not = \boldsymbol{x^*}$，都有$f(\boldsymbol{x^*}) < f(\boldsymbol{x})$，则称$\boldsymbol{x^*}$为$f(x)$的严格局部极小解，$f(\boldsymbol{x^*})$为严格局部极小值。

2. **全局极小**
对于$\boldsymbol{x^*}∈K$，且$\forall \boldsymbol{x}\in K$，都有$f(\boldsymbol{x^*}) \le f(\boldsymbol{x})$，则称$\boldsymbol{x^*}$为$f(x)$的全局极小点，$f(\boldsymbol{x^*})$为全局极小值。
对于$\boldsymbol{x^*}∈K$，且$\forall \boldsymbol{x}\in K，\boldsymbol{x} \not = \boldsymbol{x^*}$，都有$f(\boldsymbol{x^*}) < f(\boldsymbol{x})$，则称$\boldsymbol{x^*}$为$f(x)$的严格全局最优解，$f(\boldsymbol{x^*})$为严格全局最优值。
![97f38d799573e8da5066e6d9c6a072e.jpg|400](https://cdn.jsdelivr.net/gh/BlackJack0083/image@main/img/97f38d799573e8da5066e6d9c6a072e.jpg)

#### 线性规划与线性规划的区别
- 目标约束不同：线性规划的目标函数和约束条件都是其自变量的线性函数（一次式）；非线性规划的目标函数和约束条件都是其**自变量的非线性函数**（含有非线性成分）。
- 最优解范围不同：如果最优解存在，线性规划只能存在**可行域的边界**上找到；非线性规划的最优解可能存在于**可行域的任意一点**。

### 求解
#### Hesse矩阵
设n元函数$f(x)$对自变量$\boldsymbol{x}$的各分量$x_i$的二阶偏导数$\frac{\partial^2 f(\boldsymbol{x})}{\partial x_i \partial x_j}(i=1,...,n;j=1,...,n)$都存在，则称函数$f(x)$在点$\boldsymbol x$处二阶可导，并称矩阵
![image.png|550](https://cdn.jsdelivr.net/gh/BlackJack0083/image@main/img/20240510212650.png)
为$f(x)$在$x$的二阶导数或Hesse矩阵，记为$\nabla^2 f(\boldsymbol x)$，即
$$\nabla^2 f(\boldsymbol x)=(\frac{\partial^2 f(\boldsymbol{x})}{\partial x_i \partial x_j})_{n \times n}$$
有时记为$G(\boldsymbol x )$

若$f(x)$对$x$各变元的所有二阶偏导数都连续，则
$$\frac{\partial^2 f(\boldsymbol{x})}{\partial x_i \partial x_j} = \frac{\partial^2 f(\boldsymbol{x})}{\partial x_j \partial x_i}$$
此时称$\nabla^2 f(\boldsymbol x)$为对称矩阵

#### 无约束问题
##### 一阶必要条件
无约束问题：
$$\min_{x \in R^n} f(x)$$
设$f(x)$一阶连续可微. 若$\boldsymbol x^*$是无约束问题的一个局部解，则
$$\nabla f(\boldsymbol x^*)=0$$
##### 二阶充分条件
设$f(x)$二阶连续可微，且
$$\nabla f(x^*)=0, \nabla^2 f(x^*)为正定$$
则$x^*$为无约束问题的一个严格局部解。
>[!info] 补充
> $A$ 是正定的，如果有 $𝑥^𝑇𝐴𝑥>0$ 对任意非零向量都成立。[线性代数之——正定矩阵 - seniusen的文章 - 知乎](https://zhuanlan.zhihu.com/p/93392382)
>上述证明需要用到二阶taylor展开，交给数学系同学去证明叭(笑)

#### 有约束问题
##### 拉格朗日乘数法
对于特殊的只有等式约束的非线性规划问题的情形：
$$\min f(\boldsymbol x)$$
$$s.t.\quad  h_j(\boldsymbol{x})=0, j=1,2,...,q.$$
有如下的拉格朗日定理：
设函数$f,h_j(j=1,2,...,q)$在可行点$\boldsymbol x^*$的某个邻域$N(\boldsymbol x^*, \epsilon)$内可微，向量组$\nabla h_j(\boldsymbol{x^*})$线性无关，令
$$L(x, \lambda)=f(x)+\lambda^TH(x)$$
其中$\boldsymbol{\lambda}=[\lambda_1,...,\lambda_q]^T\in R^q$，$H(x)=[h_1(x), h_2(x),....,h_q(x)]^T$。
若$\boldsymbol{x^*}$是上式有约束问题的最优解，则存在实向量$\boldsymbol{\lambda^*}=[\lambda_1^*,...,\lambda_q^*]^T\in R^q$，使得$\nabla L(\boldsymbol{x^*}, \boldsymbol{\lambda^*})=0$，即
$$\nabla f(\boldsymbol{x^*})+\sum_{j=1}^q\lambda_j^*\nabla h_j(\boldsymbol{x^*})=0$$
显然，拉格朗日定理可以将原本含等式的有约束问题转化为无约束问题进行求解。
#### 罚函数法(不讲，仅供参考)
惩罚函数法求解非线性规划问题，是利用问题中的约束函数做出适当的惩罚函数，由此构造出带参数的增广目标函数，将问题转化为无约束非线性规划问题。下面介绍外惩罚函数法。
![image.png|550](https://cdn.jsdelivr.net/gh/BlackJack0083/image@main/img/20240510222448.png)
#### 经典方法
[知乎盐选 | 2.1　非线性规划问题的一些实用求解方法 (zhihu.com)](https://www.zhihu.com/market/pub/120210134/manuscript/1396871852682207232)
[【数学建模】数学建模学习3---非线性规划例题+matlab代码实现_数学建模非线性规划matlab例题-CSDN博客](https://blog.csdn.net/qq_44528283/article/details/117400926)
- 一维最优化方法：黄金分割法，切线法，插值法
- 无约束最优化方法：梯度法，牛顿法，共轭梯度法，拟牛顿法
- 约束最优化方法：制约函数法，可行方向法

### 万恶(最牛)的KKT(KT)
#### 凸规划(不讲)
[运筹说 第96期 | 非线性规划基本概念 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/678051103)
![image.png|575](https://cdn.jsdelivr.net/gh/BlackJack0083/image@main/img/20240511000254.png)
![image.png|575](https://cdn.jsdelivr.net/gh/BlackJack0083/image@main/img/20240511000300.png)
![image.png|575](https://cdn.jsdelivr.net/gh/BlackJack0083/image@main/img/20240511000333.png)
![image.png|575](https://cdn.jsdelivr.net/gh/BlackJack0083/image@main/img/20240511000352.png)

#### 引入
对带一般约束的非线性规划问题式，引进拉格朗日函数如下：
$$L(\boldsymbol{x, \lambda,\mu})=f(\boldsymbol{x})+\sum_{i=1}^p\boldsymbol{\lambda_i}g_i(\boldsymbol x) +\sum_{j=1}^q\boldsymbol{\mu_j}h_j(\boldsymbol x) $$
式中：$\boldsymbol{\lambda} = [\lambda_1, ..., \lambda_p]^T$，$\boldsymbol{\mu} = [\mu_1, \mu_2,...,\mu_q]^T$称为拉格朗日乘子

#### KT条件(必要条件)
[KKT条件，原来如此简单 | 理论+算例实践 - 科研小飞的文章 - 知乎](https://zhuanlan.zhihu.com/p/556832103)
设$\boldsymbol{x^*}$是非线性规划问题式的局部最优解，而且$\boldsymbol{x^*}$点的所有起作用约束的梯度$\nabla g_i(\boldsymbol{x^*})(i=1,2,...,p)$ 和$\nabla h_j(\boldsymbol x^*)(j=1,2,...,q)$线性无关，则存在向量$\boldsymbol{\lambda^*} = [\lambda_1^*, ..., \lambda_p^*]^T$，$\boldsymbol{\mu^*} = [\mu_1^*, \mu_2^*,...,\mu_q^*]^T$使下述条件成立：
$$\begin{cases}\nabla f(\boldsymbol x^*) + \sum_{i=1}^p\boldsymbol{\lambda_i^*}g_i(\boldsymbol x^*) +\sum_{j=1}^q\boldsymbol{\mu_j^*}h_j(\boldsymbol x^*) = 0, \\
\boldsymbol{\lambda_i^*}g_i(\boldsymbol x^*) = 0, &i = 1,2,...,p,\\
\boldsymbol{\lambda_i^*} \ge 0, &i = 1,2,...,p.
\end{cases}$$
满足以上条件的点称为库恩-塔克点(KT点)

#### 充分条件
若$\boldsymbol{x}$满足库恩-塔克条件，则$\boldsymbol{x}$必为凸规划的局部最优解，进而为全局最优解

### 例题(看看分析思路，太长了...抄不下来)
>一家彩电制造商计划推出两种产品：一种为19 英寸液晶平板电视机，零售价为339美元；另一种为21英寸液晶平板电视机，零售价为399 美元。公司付出的成本为19英寸彩电每台195美元，21英寸彩电每台225美元，还要加上400000美元的固定成本，在竞争的销售市场中，每年售出的彩电数量会影响彩电的平均售价。据统计，对每种类型的彩电，每多售出一台，平均销售价格会下降1美分。而且19英寸彩电的销售会影响21 英寸彩电的销售，反之亦然。据估计，每售出一台 21英寸彩电，19 英寸彩电的平均售价会下降0.3美分，而每售出一台19英寸彩电，21英寸彩电的平均售价会下降0.4美分。问题是：每种彩电应该各生产多少台?

我们采用处理数学建模问题的五步方法来解决这个问题。第一步是提出问题。我们首先列出一张变量表，然后写出这些变量间的关系和所做的其他假设，如要求取值非负。最后，采用我们引入的符号，将问题用数学公式表达。第一步的结果归纳在表中。
![1199193a45f493be75794f00edfb810.jpg|575](https://cdn.jsdelivr.net/gh/BlackJack0083/image@main/img/1199193a45f493be75794f00edfb810.jpg)
![d52bbf45dd5aca0364e4f3cff9f4dac.jpg|575](https://cdn.jsdelivr.net/gh/BlackJack0083/image@main/img/d52bbf45dd5aca0364e4f3cff9f4dac.jpg)
![fd51d60d0aa2bd7c8e222d59785eeb2.jpg|575](https://cdn.jsdelivr.net/gh/BlackJack0083/image@main/img/fd51d60d0aa2bd7c8e222d59785eeb2.jpg)
![7375f5e3ad52ba62cf756b1ff3141ff.jpg|575](https://cdn.jsdelivr.net/gh/BlackJack0083/image@main/img/7375f5e3ad52ba62cf756b1ff3141ff.jpg)
![339e3f8af54927906e2053389867d49.jpg|575](https://cdn.jsdelivr.net/gh/BlackJack0083/image@main/img/339e3f8af54927906e2053389867d49.jpg)
![19dee6c35b104d407cd860f2c9daeed.jpg|575](https://cdn.jsdelivr.net/gh/BlackJack0083/image@main/img/19dee6c35b104d407cd860f2c9daeed.jpg)
代码：
```python
import sympy as sp
import pylab as plt

plt.rc('text', usetex=True)  #使用LaTeX字体
plt.rc('font',size=14)
sp.var('x1, x2')  #定义符号变量
y = (339-0.01*x1-0.003*x2)*x1+(399-0.004*x1-0.01*x2)*x2-(400000+195*x1+225*x2)
y = sp.simplify(y)   #化简
dy1 = y.diff(x1)     #求关于x1的偏导
dy2 = y.diff(x2)     #求关于x2的偏导
s = sp.solve([dy1, dy2], [x1, x2])
x10 = round(float(s[x1]))   #取整
x20 = round(float(s[x2]))
y0 = y.subs({x1: x10, x2: x20})  #符号函数代入数值
f = sp.lambdify('x1, x2', y, 'numpy')  #符号函数转换为匿名函数
x = plt.linspace(0, 10000, 100)
X, Y = plt.meshgrid(x, x)  #转换为网格数据
Z = f(X, Y)
ax=plt.subplot(121, projection='3d')  #第一个子窗口三维画图
ax.plot_surface(X, Y, Z,cmap='viridis')
ax.set_xlabel('$x_1$'); ax.set_ylabel('$x_2$')
plt.subplot(122)  #激活第二个子窗口
contr=plt.contour(X,Y,Z,10)  #10条等高线
plt.clabel(contr)   #等高线标注
plt.ylabel('$x_2$',rotation=0)
plt.xlabel('$x_1$')

sp.var('a', pos=True)  #定义灵敏度分析的符号参数
y = (339-a*x1-0.003*x2)*x1+(399-0.004*x1-0.01*x2)*x2-(400000+195*x1+225*x2)
y = sp.simplify(y)   #化简
dy1 = y.diff(x1)     #求关于x1的偏导
dy2 = y.diff(x2)     #求关于x2的偏导
s = sp.solve([dy1, dy2], [x1, x2])
sx1 = s[x1]; sx2 = s[x2]  #提取解分量
s1 = sp.lambdify('a', sx1, 'numpy')  #符号函数转换为匿名函数
s2 = sp.lambdify('a', sx2, 'numpy')

a0 = plt.linspace(0.002, 0.02, 50)
plt.figure()
plt.subplots_adjust(wspace = 0.65)
plt.subplot(121); plt.plot(a0, s1(a0))
plt.xlabel('$a$'); plt.ylabel('$x_1$')
plt.subplot(122); plt.plot(a0, s2(a0))
plt.xlabel('$a$'); plt.ylabel('$x_2$')

dx1 = sx1.diff(a); dx10 = dx1.subs(a, 0.01)
sx1a = dx10 * 0.01 / 4735
dx2 = sx2.diff(a); dx20 = dx2.subs(a, 0.01)
sx2a = dx20 * 0.01 / 7043
Y = y.subs({x1: s[x1], x2: s[x2]})  #求关于a的目标函数
Y = sp.factor(Y); Y = sp.simplify(Y)
Ya = sp.lambdify('a', Y, 'numpy')  #转换为匿名函数
a0 = plt.linspace(0.002, 0.02, 1000)
plt.figure(); plt.plot(a0, Ya(a0))
plt.xlabel('$a$'); plt.ylabel('$y$', rotation=0)
Sya = - 4735 ** 2 * 0.01 / 553641.025
y2 = y.subs({x1: 4735, x2: 7043, a: 0.011})  #计算近似最优利润
y3 = Y.subs(a, 0.011)   #计算最优利润
delta = (y3 - y2) / y2  #计算利润的相对误差
plt.show()
```

### 其他例子
#### 凸规划
$$\min z = |x_1| + 2|x_2|+3|x_3|+4|x_4|$$
$$s.t. \quad \begin{cases}x_1 - x_2 - x_3 + x_4 = 0,\\x_1 - x_2 + x_3 - 3x_4 = 1,\\x_1 - x_2 - 2x_3 + 3x_4 = -\frac{1}{2}\end{cases}$$
```python
#程序文件ex5_7_1.py
import cvxpy as cp
import numpy as np

c = np.arange(1, 5)
a = np.array([[1,-1,-1,1], [1,-1,1,-3], [1,-1,-2,3]])
b = np.array([0, 1, -1/2])
x = cp.Variable(4)
obj = cp.Minimize(c @ cp.abs(x))
con = [a @ x == b]
prob = cp.Problem(obj, con)
prob.solve(solver='GLPK_MI')
print("最优值为:", prob.value)
print("最优解为：\n", x.value)
```
#### 非凸规划
$$\min f(x) = x_1^2 + x_2^2 + x_3^2 + 8,$$
$$s.t. \quad \begin{cases}
x_1^2-x_2+x_3^2\ge0,\\
x-1+x_2^2+x_3^3\le 20,\\
-x_1-x_2^+2=0,\\
x_2+2x_3^2 = 3,\\
x_1,x_2,x_3\ge 0.\end{cases}$$
```python
#程序文件ex5_6.py
import numpy as np
from scipy.optimize import minimize

obj=lambda x: sum(x**2)+8
def constr1(x):
    x1, x2, x3 = x
    return [x1**2-x2+x3**2,
            20-x1-x2**2-x3**2]
def constr2(x):
    x1, x2, x3 = x
    return [-x1-x2**2+2, x2+2*x3**2-3]
con1={'type': 'ineq', 'fun': constr1}
con2={'type': 'eq', 'fun': constr2}            
con=[con1, con2]  #构造全部约束条件
bd = [(0, np.inf) for i in range(3)]
res = minimize(obj, np.random.randn(3), constraints=con, bounds=bd)
print(res)  #输出解的信息
```
## 二次规划问题(特殊的非线性)
目标函数为决策向量$X=[x-1,x_2,...,x_n]^T$的二次函数，约束条件均为线性
$$\max(\min) \sum_{i=1}^n \sum_{j=1}^n c_{ij}x_ix_j + \sum_{i=1}^n d_i x_i$$
$$s.t. \quad \begin{cases}
\sum_{j=1}^n a_{ij}x_j \le b_i, i = 1,2,...,m,\\
x_i \ge 0, i = 1,2,..,n.
\end{cases}$$

## 多目标规划问题(21 国赛C)
> 某建筑和装饰板材的生产企业所用原材料主要是木质纤维和其他植物素纤维材料,总体可分为 A，B，C 三种类型。该企业每年按 48 周安排生产，需要提前制定 24 周的原材料订购和转运计划，即根据产能要求确定需要订购的原材料供应商（称为“供应商”）和相应每周的原材料订购数量（称为“订货量”），确定第三方物流公司（称为“转运商”）并委托其将供应商每周的原材料供货数量（称为“供货量”）转运到企业仓库。
> 该企业每周的产能为 2.82 万立方米，每立方米产品需消耗 A 类原材料0.6 立方米，或 B 类原材料 0.66 立方米，或 C 类原材料 0.72 立方米。由于原材料的特殊性，供应商不能保证严格按订货量供货，实际供货量可能多于或少于订货量。
> 为了保证正常生产的需要，该企业要尽可能保持不少于满足两周生产需求的原材料库存量，为此该企业对供应商实际提供的原材料总是全部收购。在实际转运过程中，原材料会有一定的损耗（损耗量占供货量的百分比称为“损耗率”），转运商实际运送到企业仓库的原材料数量称为“接收量”。每家转运商的运输能力为 6000 立方米/周。
> 通常情况下，一家供应商每周供应的原材料尽量由一家转运商运输。原材料的采购成本直接影响到企业的生产效益，实际中 A 类和 B 类原材料的采购单价分别比 C 类原材料高 20%和 10%。三类原材料运输和储存的单位费用相同。
> 附件 1 给出了该企业近 5 年 402 家原材料供应商的订货量和供货量数据。附件 2 给出了 8 家转运商的运输损耗率数据。请你们团队结合实际情况，对相关数据进行深入分析，研究下列问题：
> 2．参考问题 1，该企业应至少选择多少家供应商供应原材料才可能满足生产的需求？针对这些供应商，为该企业制定未来 24 周每周最经济的原材料订购方案，并据此制定损耗最少的转运方案。试对订购方案和转运方案的实施效果进行分析

### 基本理论
在进行多目标决策时，当希望**每个目标都尽可能大（或尽可能小）** 时，就形成了一个多目标规划问题，其一般形式为
$$\min f(x)=[f_1(x), f_2(x),...,f_m(x)]^T, \tag{5.1}$$
$$st. \begin{cases} g_i(x) \leq 0, & i = 1,2,...,p \\ h_j(x)=0, & j=1,2,...,q \tag{5.2} \end{cases}$$
其中，$x$为决策向量，$f_1(x), \ f_2(x)$为目标函数，式(5.2)为约束条件。记$\Omega$为多目标规划的可行域（决策空间）：
$$\Omega=\{x|g_i(x) \leq 0, i=1,2,...,p; \quad h_j(x)=0,j=1,2,...,q\}$$
$f(\Omega)=\{f(x)|x\in \Omega\}$为多目标规划问题的像集（目标空间）。

**定义：**
设$\bar x \in \Omega$，若多余任意$i=1,2,...,m$及任意$x\in \Omega$，均有
$$f_(\bar x) \leq f_i(x)$$则称$\bar x$为问题（MP）的**绝对最优解**，及问题（MP）的绝对最优解集为$\Omega_{ab}^*$

但由于多目标规划问题的绝对最优解不常见，因此常用非劣解或有效解，也称为**Pareto最优解:**

**定义：**
考虑多目标规划问题（MP），设$\bar x \in \Omega$，若不存在$x \in \Omega$使得
$$f_i(\bar x) \leq f_( x) ,i=1,2,...,m,$$
但至少有一个
$$f_j(\bar x)< f_j( x)$$则称$\bar x$为问题（MP）的*有效解*，$f(\bar x)$为有效点

**满意解：**
这一概念主要是从决策角度，根据决策者的偏好与要求提出的。
设可行域为$\Omega$，要求$m$个目标函数$f_i(i=1,2,...,m)$越小越好。有时决策者的期望较低，给出了$m$个阈值$\alpha_i$，当$\bar x \in \Omega$满足$f_i(\bar x) \leq \alpha_i(i=1,2,...,m)$时，就认为$\bar x$是可以接受的，是满意的。

### 求解思路
某一个规划问题中有多个目标，例如企业再保证利润最大时也要保证生产时产生的污染最小，这种情况下我们可以对多目标函数进行加权组合或是划分优先级，使其**变成单目标规划**，然后再利用先前学的知识进行求解。
#### 预处理
1. 无量纲化处理
2. 数量级归一化处理

#### 线性加权法
该方法的基本思想是根据目标的重要性确定一个权重，以目标函数的加权平均值为评价函数，使其达到最优。基本步骤如下：

1. 确定每个目标的**权系数**
	$$ 0 \leq w_j\leq 1, j = 1,2,...,m;\quad \sum_{j=1}^m w_j=1$$
2. **写出评价函数**$\sum_{j=1}^m w_j f_j$
3. **求评价函数最优值**
	$$\min \sum_{i=1}^m w_if_i(x),\quad st.x\in \Omega $$
该方法应用的关键是要确定每个目标的权重，它反映不同目标在决策者心中的重要程度，重要程度高权重就大，反之就小。但由于权重一般由决策者给出，因而具有较大的主观性。

*注意*：
	  ①首先要将多个目标函数**统一为最大化或最小化问题**后才可以进行加权组合
	  ②如果目标函数的量纲不相同，则要将其进行**标准化**后再进行加权，标准化的方法一般是用目标函数除以某一个常量，该常量是这个目标函数的某个取值，具体取何值可根据经验确定
	  ③对对目标函数进行加权求和时，权重需要由该问题领域的专家给定，在实际建模比赛中，若无特殊说明，我们可以**令权重相同**

#### 优先级法(序贯解法)

该方法的基本思想是根据目标重要性分成不同优先级，先求优先级高的目标函数的最优值，在确保优先级高的目标获得不低于最优值的条件下，再求优先级低的目标函数，具体步骤如下：

1. 确定优先级
2. 求**第一级单目标最优值**$f_1^*=\min_{x \in \Omega}f_1(x)$
3. 以*第一级单目标等于最优值*为**约束**，求**第二级目标最优**。
$$\min f_2(x), \quad st.\begin{cases} f_1(x)=f_1^*\\ x \in \Omega \end{cases}$$
4. 以*第一、第二级单目标等于其最优值*为**约束**，求第三级目标最优。以此递推。

该方法适用于目标有明显轻重之分的问题，也就是说，各目标的重要性差距比较大，首先确保最重要的目标，然后再考虑其他目标。在同一等级的目标可能会有多个，这些目标的重要性，没有明显的差距，可以用加权方法求解。

### 典型例题
![[微信截图_20230823004103.png]]
解（线性加权法求解）：
设工厂每月生产产品A$x_1$吨，B$x_2$吨，那么产生的污染分别为$0.4x_1$吨和$0.3x_2$吨，问题的数学模型表达为**多目标规划问题**：
$$
\left\{  
             \begin{array}{**lr**}  
             \min f_1 = 2x_1 + 5 x_2, &  \\
             \min f_2 = 0.4x_1 + 0.3x_2 \\  
             \end{array}  
\right.  
$$
$$st.\begin{cases}x_1+x_2 \ge 7 \\ 0 \leq x_1 \leq 5\\ 0 \leq x_2 \leq 6\end{cases}$$
下面我们将其转换为一个*单目标规划问题*，即对上面的两个目标函数进行**加权**。由于该工厂决策认为*环境污染应优先考虑*，因此我们可以选取$f_1$和$f_2$的权重分别为 0.4 和 0.6。注意到两个目标函数的单位不同，一个为“万元”，一个为“吨”，因此我们需要首先对目标函数进行**标准化**来消除量纲的影响，然后再进行加权。由于题目中已经给了产品费用和污染量的参考值，因此我们将这两个目标函数分别除以其参考值来消除量纲。

那么加权组合后的目标函数：
$$f = 0.4 \times \frac{f_1}{30}+0.6\times \frac{f_2}{2} = \frac{0.4}{30}\times(2x_1+5x_2)+\frac{0.6}{2}\times(0.4x_1+0.3x_2)$$

那么就可以得到一个单目标规划问题，通过`python`进行求解：
```python
import cvxpy as cp  
from numpy import array  
  
c = array([11/75, 235/1500])  # 定义目标向量,这个地方需要进行化简  
a = array([[1, 1], [1, 0], [0, 1]])  # 定义约束矩阵  
b = array([100, 5, 6])  # 定义约束条件的右边向量  
d = array([7, 0, 0])  # 定义约束条件的左边向量  
  
x = cp.Variable(2, pos=True)  # 定义2个决策变量  
obj = cp.Minimize(c@x)    # 构造目标函数，注意最大化用Maximize  
cons = [d <= a@x, a@x <= b]   # 构造约束条件  
  
prob = cp.Problem(obj, cons)  # 求解问题  
prob.solve(solver='GLPK_MI')  
print("最优解为：", x.value)
```

解得
$$x_1 = 5, \quad x_2 = 2, \quad f_1 = 20, \quad f_2 = 2.6$$
### 例题2(摘自教材)
![[微信图片_20230823162095.jpg]]
![[微信图片_20230823162109.jpg]]
![[微信图片编辑_20230823162129.jpg]]

**代码：**
```python
import numpy as np  
import cvxpy as cp  
  
c1 = np.array([-2, -3])  
c2 = np.array([1, 2])  
a = np.array([[0.5, 0.25], [0.2, 0.2], [1, 5], [-1, -1]])  
b = np.array([8, 4, 72, -10])  
x = cp.Variable(2, pos=True)  
obj = cp.Minimize(0.5 * (c1 + c2) @ x)  
con = [a @ x <= b]  
prob = cp.Problem(obj, con)  
prob.solve(solver='GLPK_MI')  
print('最优解为：', x.value)  
print('最优值为：', prob.value)  
  
obj1 = cp.Minimize(c1 @ x)  
prob1 = cp.Problem(obj1, con)  
prob1.solve(solver='GLPK_MI')  
v1 = prob1.value  #第一个目标函数的最优值  
obj2 = cp.Minimize(c2 @ x)  
prob2 = cp.Problem(obj2, con)  
prob2.solve(solver='GLPK_MI')  
v2 = prob2.value  #第二个目标函数的最优值  
print('两个目标函数的最优值分别为：', v1, v2)  
obj3 = cp.Minimize((c1@x-v1)**2+(c2@x-v2)**2)  
prob3 = cp.Problem(obj3, con)  
prob3.solve(solver='CVXOPT')  
print('解法二的最优解：', x.value)  
  
con.append( c1 @ x == v1)  
prob4 = cp.Problem(obj2, con)  
prob4.solve(solver='GLPK_MI')  
x3 = x.value   #提出最优解的值  
print('解法三的最优解：', x3)  
print('利润：', -c1@x3); print('排放污染物：', c2@x3)
```


### 补充：敏感性（灵敏度）分析

**敏感性分析**是指从定量分析的角度研究有关因素发生某种变化对某一个或一组关键指标影响程度的一种不确定分析技术。其实质是通过*逐一改变相关变量数值*的方法*来解释关键指标受这些因素变动影响大小的规律*

通常都是改变关键指标的系数或者权重进行分析

![[微信截图_20230823121842.png]]

## 模糊规划(略)
### 使用背景
在一些实际问题中，约束条件可能带有弹性，目标函数可能不单一，价值系数可能带有模糊性。这些问题可以用模糊的方法来处理。
没有什么资料。。所以暂时先不介绍了
