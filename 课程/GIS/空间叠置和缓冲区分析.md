- `from` 笛卡尔积
# 空间叠置分析
- 多数GIS软件以分层的方式组织地理信息，叠置分析是最常用的提取空间隐含信息的手段之一
- 叠置分析是将同一区域、同一比例尺、同一数学基础(投影)的两个或多个图层进行叠置，生成一个具有多重属性的新图层的操作
	- 对那些在**结构和属性上既相互重叠，又相互联系**的多种现象要素进行综合分析和评价。
	- 对反映不同时期同一地理现象的多边形进行多时相分析，从而深入揭示**各种现象要素的内在联系及其发展规律**。
	- 另一个涉及叠置操作的基本空间分析是**缓冲区分析**，它是为了识别某个空间目标对其周围环境的影响范围或服务范围，而在其周围建立的具有一定宽度的带状区。
	- 缓冲区在现实上是一个圆，但在计算机中存的是数据表(圆心$(x_0,y_0)$已知，半径$R$已知)：

| No  | angle | radian        | x                 | y                    |
| --- | ----- | ------------- | ----------------- | -------------------- |
| 1   | 1°    | arctan(1)/180 | $x_0+Rcos \theta$ | $y_0 + R_sin \theta$ |
| 2   | 2°    | ...           | ...               | ...                  |
| ... | ...   |               |                   |                      |
![image.png|348](https://cdn.jsdelivr.net/gh/BlackJack0083/obsidian@main/img/20240325183105.png)

- 根据不同的空间数据结构，可分为**矢量叠置**和**栅格叠置**两类
- 叠置分析由输入图层、叠置图层、输出图层组成
	- 输入图层：被叠置的要素图层
	- 叠置图层：对输入图层进行叠置操作的图层
	- 输出图层：生成的带有输入要素属性和叠置要素属性新图层
- 叠置分析需要对地理信息的图形和属性进行叠置处理
	- 矢量数据模型以点、线、面等简单几何对象来表示空间要素，叠置分析时空间要素图形处理比较复杂。
	- 栅格数据模型则以格网的形式记录属性信息，空间信息隐含，不涉及图形要素的叠置处理。
	- 属性叠置处理分为代数运算与逻辑运算两大类（取决于属性类型）
	- 点在多边形内/外的判断：
		- 参考Games101，线都是一个向量，如果一个点与所有向量的叉乘都是负数，那么说明点在多边形外侧

# 矢量数据叠置分析
矢量叠置分析是空间叠置分析的主要内容，回答GIS的基本问题“什么在什么上”，如：
	不同土地利用分布在什么土壤类型上？
	什么宗地在百年一遇的洪泛区中？
	什么井在废弃的军事基地中？
研究对象主要是点、线、多边形之间的相互叠置，主要类型有：
	点与多边形叠置
	线与多边形叠置
	多边形与多边形叠置
### 点与多边形叠置
- 将点层作为输入图层叠加到一个多边形图层上，生成的**新图层仍然是点层**。
- 叠置过程中进行了点与多边形位置关系的判断，即通过计算点与多边形线段的相对位置，来判断这个点是否在多边形内，从而确定是否进行属性信息的叠加。
![image.png|500](https://cdn.jsdelivr.net/gh/BlackJack0083/obsidian@main/img/20240325183700.png)
### 线与多边形叠置
线与多边形的叠加分析结果产生了一个新的线状数据层，该层内的线状目标属性表发生变化，可能不与原来的属性表一一对应
![image.png|500](https://cdn.jsdelivr.net/gh/BlackJack0083/obsidian@main/img/20240325183858.png)
- 线与多边形的叠加分析结果产生了一个新的线状数据层，该层内的线状目标属性表发生变化，**可能不与原来的属性表一一对应**
- 叠加分析操作后既可确定每条线段落在哪个多边形内，也可查询指定多边形内指定线段穿过的长度
- 叠加分析还可能形成新的多边形
![image.png|500](https://cdn.jsdelivr.net/gh/BlackJack0083/obsidian@main/img/20240325184024.png)
### 面与多边形叠置
首先对两层多边形的边界进行几何求交运算，将原始多边形图层中的边界要素切割成新的弧段，再根据切割后的弧段要素重建拓扑关系，进而对新生成的多边形图层中的每个目标赋予惟一标识码，生成一个与新多边形图层一一对应的属性表。
![image.png|500](https://cdn.jsdelivr.net/gh/BlackJack0083/obsidian@main/img/20240325184442.png)

根据所要保留的空间特征的不同，常用的多边形叠置分析操作可分为交（Intersect）、并(Union)、叠和(Identity)
- 交：保留输入图层和叠置图层公共部分的空间图形，并综合两个叠加图层的属性。
![image.png|425](https://cdn.jsdelivr.net/gh/BlackJack0083/obsidian@main/img/20240325184541.png)

- 并：输出图层的范围是输入图层和叠置图层的范围之和，并保留两个图层的空间要素和属性信息。
![image.png|425](https://cdn.jsdelivr.net/gh/BlackJack0083/obsidian@main/img/20240325184557.png)

- 叠和：以输入图层定义的区域范围为界，保留边界内输入图层和叠置图层的所有多边形，输入图层切割后的多边形也被赋予叠加图层的属性。
![image.png|425](https://cdn.jsdelivr.net/gh/BlackJack0083/obsidian@main/img/20240325184609.png)

# 栅格数据叠置分析
### 分析内容
栅格叠置分析是将不同图幅或不同数据层的栅格数据叠加在一起，在叠置图层的相应位置上生成新属性的分析方法
基于不同的运算方式，栅格属性值的运算包括以下几种类型：
	局部变换
	邻域变换
	分带变换
	全局变换
	布尔逻辑叠置
### 局部变换
- 局部变换是**基于像元自身的运算**，变换后的输出值仅与该像元有关，不考虑与之相邻的其他像元。
- 单层格网的局部变换将原栅格的像元值乘以**常数**后即为输出栅格图层中相应格网位置的像元值。
- 多层局部变换，可用同一地理区域的乘数栅格代替单层局部变换中的常数。
![|475](https://cdn.jsdelivr.net/gh/BlackJack0083/obsidian@main/img/20240325190149.png)

### 邻域变换
- 邻域变换是以某一像元为中心，通过对一定辐射范围内与其相邻的像元值进行简单求和、求最大值、最小值、平均值等运算，计算输出栅格的像元值。
- 辐射范围可是规则正方形格网，也可是圆形、环形和楔形
![image.png|475](https://cdn.jsdelivr.net/gh/BlackJack0083/obsidian@main/img/20240325190334.png)
### 分带变换
- 分带变换是将同一区域内具有相同属性值的像元作为整体进行分析运算，可选取多种统计量，如最值、均值等。
- 由于属性值相同的像元可能并不相邻，可通过分带栅格图层定义具有相同属性值的栅格。
![image.png|500](https://cdn.jsdelivr.net/gh/BlackJack0083/obsidian@main/img/20240325190435.png)
### 全局变换
- 基于研究区域内所有像元的运算，通常是指在同一格网内进行像元与像元之间距离的量测。
- 较常见量测是确定区域内每个像元与其**最近源像元的距离**。
![image.png|475](https://cdn.jsdelivr.net/gh/BlackJack0083/obsidian@main/img/20240325190510.png)
### 布尔逻辑叠置
栅格叠置的一种表现方法，进行叠置分析时需要建立多个二值图，然后对各个图层进行布尔逻辑运算，最后生成结果图
布尔逻辑算子有与（AND）、或（OR）、非（NOT）、异或（XOR）等
![image.png|450](https://cdn.jsdelivr.net/gh/BlackJack0083/obsidian@main/img/20240325190543.png)
# 矢量数据缓冲区分析
#### 缓冲区
- 是指为了识别某一地理实体对其周围地物的影响程度，而在其周围建立的具有一定宽度的带状区域。
	- 建造一条铁路，要考虑到铁路的宽度以及铁路两侧所保留的安全带，以计算铁路实际占用的空间
- 可以视为空间目标的一种影响范围或服务范围
	- 公共设施如商场、医院、学校等的位置选择都要考虑其服务范围
#### 缓冲区分析
是对一组或一类地物按缓冲的距离条件，建立缓冲区多边形，然后将这一图层与需要进行缓冲区分析的图层进行叠加分析，得到所需结果的一种空间分析方法。
![image.png|500](https://cdn.jsdelivr.net/gh/BlackJack0083/obsidian@main/img/20240325191600.png)
给定空间对象或集合，确定其邻域，邻域的大小由邻域半径R决定，因此对象Oi的缓冲区定义为：
 $$Bi=\{x | d(x, O_i)<=R\}$$
$B_i$为距$O_i$ 的距离小于$R$的全部点的集合；$d$一般指最小欧氏距离，但也可以为其他定义的距离，如网络距离。
对于对象集合$O=\{Oi | i =1, 2,…, n\}$，其半径为$R$的缓冲区是各个对象缓冲区的并集$B=\cup_{i=1}^n B_i$
#### 缓冲区生成分类
- 根据研究对象的影响力，缓冲区具有均质与非均质的特性，可分为**静态缓冲区和动态缓冲区**
- 根据研究数据类型，可分为**矢量数据缓冲区、栅格数据缓冲区**
- 根据研究目标维度，缓冲区可分为**点目标缓冲区、线目标缓冲区、面目标缓冲区**
![image.png|600](https://cdn.jsdelivr.net/gh/BlackJack0083/obsidian@main/img/20240325191955.png)
##### 点目标缓冲区
点目标缓冲区是以点目标为圆心，以缓冲距离为半径所绘制的区域，其中包括单点目标形成的缓冲区、多点目标形成的缓冲区和分级点目标形成的缓冲区
![image.png|575](https://cdn.jsdelivr.net/gh/BlackJack0083/obsidian@main/img/20240325192108.png)
##### 线目标缓冲区
线要素的缓冲区是以线要素为轴线，以缓冲距离R为平移量向两侧作平行曲(折)线，在轴线两端构造两个半圆弧最后形成圆头缓冲区，包括单线、多线和分级线形成的缓冲区
![image.png|475](https://cdn.jsdelivr.net/gh/BlackJack0083/obsidian@main/img/20240325192132.png)

**角平分线法**生成线目标缓冲区：
	确定线目标左右侧的缓冲距离$d1$和$d2$
	在中心轴线的两端点处作其垂线，分别按左右侧的缓冲距离截出**左、右边线的起止点**
	按中心轴线的前进方向，依次**计算轴线各转折点的角平分线**，在其延长线上分别按左、右侧的缓冲距离来确定各点的**左、右缓冲点位置**
	将左（右）缓冲点顺序相连，即构成左（右）缓冲区边界的基本部分
	分别在线目标的起点和终点处向外作**外接半圆**
	起点和终点处的外接半圆与左、右缓冲边界所构成的区域即为该线目标的**缓冲区**

角平分线法简单易行，但其缺点是难以保证缓冲区左右边界的等宽性

**凸角圆弧法**生成线目标缓冲区：
	基本原理是：在中心轴线的首尾点处作轴线的垂线，并按双线和缓冲区半径R截出左、右边线的起止点
	在中心轴线的其他各转折点处，首先判断该点的凸凹性，在**凸侧用半径为缓冲区的圆弧弥合**，在凹侧用与该点关联的前后相邻的轴线的偏移量为缓冲距的左右平行线的交点作为对应顶点
![image.png|500](https://cdn.jsdelivr.net/gh/BlackJack0083/obsidian@main/img/20240325192628.png)
	判断顶点的凸凹性的问题可转化为判断两个矢量的叉积。沿轴线方向依次有三个点组成两个矢量，转折点的凸凹性由矢量的叉积在Z方向上的值的符号决定，具体表达为
	![image.png|450](https://cdn.jsdelivr.net/gh/BlackJack0083/obsidian@main/img/20240325192708.png)
	根据空间解析几何可知：若S < 0，Pi为凸点；若S > 0，Pi为凹点；若S = 0，则三点共线
	![image.png|550](https://cdn.jsdelivr.net/gh/BlackJack0083/obsidian@main/img/20240325192720.png)
##### 面目标缓冲区
面目标缓冲区的基本思路与线目标缓冲区基本相同。
不同之处在于，面目标缓冲区的边界生成算法是**单线问题**，即仅在**非孔洞多边形**的外侧形成缓冲区，在孔洞多边形的内侧形成缓冲区，而在环状多边形的内外侧边界可形成缓冲区
![image.png](https://cdn.jsdelivr.net/gh/BlackJack0083/obsidian@main/img/20240325192851.png)
##### 动态缓冲区分析
现实世界中很多空间目标对周围的影响会随着距离的变化而发生变化，需要建立动态缓冲区
动态缓冲区分析模型有线性模型、二次模型、指数模型
当缓冲区内各处随着距离变化，其影响度变化速度相等时，采用线性模型 Fi=f0(1-ri)
当距离空间物体近的地方比距离物体远的地方影响度变化快时，采用二次模型Fi=f0(1-ri) 2 或指数模型 Fi=f0 (1-ri)
f0 ：参与缓冲区分析的一组空间实体的综合规模指数，一般经最大值标准化后参与运算
ri  =di/d0, d0表示该实体的最大影响距离，di表示在该实体的最大距离内的某点与该实体的距离
##### 矢量数据缓冲区重叠处理
目前，主要有三种处理方法：数学运算法、矢量栅格转换法、矢量栅格混合法。

**数学运算法**
- 将所有多边形的所有边界线段之间两两求交运算，生成所有可能的多边形，再根据多边形之间的拓扑关系和属性关系，去除某些多余的多边形。
- 运算量大，效率低，且由于存在分级目标，生成的缓冲区可能具有不同的影响度等级；若分开合并，则不同的影响度之间还可能存在重叠；若统一合并，则不同影响 度等级的缓冲区可能被合并在一起。

**矢量栅格转换法**
![image.png|95](https://cdn.jsdelivr.net/gh/BlackJack0083/obsidian@main/img/20240325193035.png)
**矢量栅格混合法**
![image.png|220](https://cdn.jsdelivr.net/gh/BlackJack0083/obsidian@main/img/20240325193055.png)
